## Ильин Сергей Евгеньевич
### Урок 2. ACID, MVCC, буферный кэш. Поток 2

#### ДЗ

1. Открыть консоль и зайти по ssh на ВМ в ЯО/любое другое подключение
2. Открыть вторую консоль и также зайти по ssh на ту же ВМ в WB cloud или ЯО
3. Запустить везде psql из под пользователя postgres к одному кластеру ПГ
4. Сделать в первой сессии новую таблицу и наполнить ее данными
5. Посмотреть текущий уровень изоляции
6. Начать новую транзакцию в обоех сессиях с дефолтным (не меняя) уровнем изоляции
7. В первой сессии добавить новую запись
8. Сделать запрос на выбор всех записей во второй сессии
9. Видите ли вы новую запись и если да то почему? После задания можете сверить правильный ответ с эталонным
10. Завершить транзакцию в первом окне
11. Сделать запрос на выбор всех записей второй сессии
12. Видите ли вы новую запись и если да то почему?
13. Завершите транзакцию во второй сессии
14. Начать новые транзакции, но уже на уровне repeatable read в ОБЕИХ сессиях
15. В первой сессии добавить новую запись
16. Сделать запрос на выбор всех записей во второй сессии
17. Видите ли вы новую запись и если да то почему?
18. Завершить транзакцию в первом окне
19. Сделать запрос во выбор всех записей второй сессии
20. Видите ли вы новую запись и если да то почему?

#### Решение
1. ```docker run -dit --name pg-master -p 6000:5432 --network pg-network -e POSTGRES_PASSWORD=dev_dev -e POSTGRES_USER=postgres -e PGDATA=/var/lib/postgresql/data/pg_data postgres:17```
2. -||-
3. в 2-ух консолях: ```docker exec -it pg-master su - postgres -c psql```
4. консоль 1: ```CREATE SCHEMA wb; create table wb.orders(id integer, name varchar(64)); insert into wb.orders values (1, 'item_1'), (2, 'item_2');```
5. в 2-ух консолях: ```SHOW TRANSACTION ISOLATION LEVEL;``` // read committed
6. в 2-ух консолях: ```begin;```
7. консоль 1: ```insert into wb.orders values (3, 'item_3');```
8. консоль 2: ```select * from wb.orders;```
9. нет, не вижу. Потому что грязное чтение не допускается в PG и уровень транзакции в ПГ по умолчанию защищает от аномалии "dirty read"
10. консоль 1: ```commit;```
11. консоль 2: ```select * from wb.orders;```
12. да, записи вижу. Уровень транзакции "read committed" не защищает от аномалии повтороного чтения, поэтому после коммита в консоли 1 и повторном чтении в консоли 2 мы получим в выборке новую добавленую запись.
13. консоль 2: ```commit;```
14. в 2-ух консолях: ```begin transaction isolation level repeatable read;```
15. консоль 1: ```insert into wb.orders values (4, 'item_4');```
16. консоль 2: ```select * from wb.orders;```
17. нет, не вижу. Потому что грязное чтение не допускается в PG и уровень транзакции в ПГ по умолчанию защищает от аномалии "dirty read"
18. консоль 1: ```commit;```
19. консоль 2: ```select * from wb.orders;```
20. нет, не увижу. Уровень транзакции "repeatable read" защитил от аномалии повторного чтения, когда Т1 в добавила запись и сделала коммит