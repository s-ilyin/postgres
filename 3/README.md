## Ильин Сергей Евгеньевич
### Урок 3. Система очистки, журнал предзаписи. Поток 2

#### ДЗ

1. Создать таблицу с текстовым полем и заполнить случайными или сгенерированными данным в размере 1 млн строк
2. Посмотреть размер файла с таблицей
3. 5 раз обновить все строчки и добавить к каждой строчке любой символ
4. Посмотреть количество мертвых строчек в таблице и когда последний раз приходил автовакуум
5. Подождать некоторое время, проверяя, пришел ли автовакуум
6. 5 раз обновить все строчки и добавить к каждой строчке любой символ
7. Посмотреть размер файла с таблицей
8. Отключить Автовакуум на конкретной таблице
9. 10 раз обновить все строчки и добавить к каждой строчке любой символ
10. Посмотреть размер файла с таблицей 
11. Объясните полученный результат 
12. Не забудьте включить автовакуум 

#### Решение

1. ```CREATE TABLE wb.errors(i varchar(128)); INSERT INTO wb.errors SELECT s.id FROM generate_series(1,1000000) AS s(id);```
2. ```\dt+ wb.errors``` // 35 MB
3. ```update wb.errors set i=i||'_' where 1=1;``` // 5 раз - 237 MB 
4. ```живых - 1000000, мертвых - 5000000, последний автовакуум - 2025-03-25 10:19:22.970368+00```
5. пришел, живых - 1000000, мертвых - 0, занято 237 MB 
6. ```update wb.errors set i=i||'_' where 1=1;``` // 5 раз
7. 237 MB (таблица не выросла в объеме)
8. ```ALTER TABLE wb.errors SET (autovacuum_enabled = off);```
9. ```update wb.errors set i=i||'_' where 1=1;``` // 10 раз
10. 569 MB (таблица выросла в объеме)
11. Поскольку мы отключили автовакуум, он перестал чистить мертвые версии строк, соответственно новые версии строк начали записываться в новые страницы и это привело к росту размера таблицы, соответственно если автовакуум включить, тогда он почистит мертвые версии строк и будущее обновления будут записываться в уже выделенные страницы (очищенные). Смысл понятен, лучше автовакуум не отключать.
12. ```ALTER TABLE wb.errors SET (autovacuum_enabled = on);```